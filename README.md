# 农场物语 - 2D农场经营游戏

一个基于Python + Pygame开发的2D农场经营游戏，使用pymssql连接SQL Server数据库。

## 功能特性

### ? 核心功能
- ? **登录系统** - 选择玩家和农场进入游戏
- ? **角色移动** - WASD或方向键控制角色在农场中自由移动
- ? **种植系统** - 在空地块上播种作物
- ? **作物生长** - 实时追踪作物生长状态（生长中/成熟/枯萎）
- ? **背包系统** - 查看和管理农场库存物品
- ? **经济系统** - 金币、宝石货币管理
- ? **数据持久化** - 所有操作自动保存到数据库
- ? **动画效果** - 角色移动动画、作物生长视觉效果

### ? 游戏玩法
1. 在登录界面选择玩家和对应的农场
2. 移动角色到空地块旁边
3. 按空格键种植作物（需要有种子）
4. 等待作物成熟（成熟时显示金黄色并闪烁）
5. 收获成熟的作物获得产出
6. 按I键打开背包查看库存
7. 清理枯萎的作物保持农场整洁

## 安装说明

### 前置要求
- Python 3.7+
- SQL Server（已安装并运行FarmGameDB数据库）
- Windows操作系统（或其他支持pymssql的系统）

### 安装步骤

1. **克隆或下载项目到本地**
```bash
cd D:\桌面\爆炸\farm_game
```

2. **安装依赖**
```bash
pip install -r requirements.txt
```

如果安装pymssql遇到问题，可以尝试：
```bash
pip install pymssql==2.2.11
```

3. **配置数据库连接**

编辑 `config.py` 文件，修改数据库配置：

```python
DB_CONFIG = {
    'server': 'localhost',        # 你的SQL Server地址
    'user': 'sa',                 # 你的用户名
    'password': 'your_password',  # 你的密码
    'database': 'FarmGameDB',
    'charset': 'utf8'
}
```

4. **确保数据库已创建并有数据**

请确保已经执行了job1文件夹中的SQL脚本：
- `SQLQuery0.sql` - 清理旧数据库
- `SQLQuery1.sql` - 创建数据库和Schema
- `SQLQuery2.sql` - 创建所有表
- `SQLQuery3.sql` - 添加Status列
- `SQLQuery4.sql` - 插入测试数据（可选）
- `insert1.sql` - 插入完整的游戏数据

5. **运行游戏**
```bash
python main.py
```

## 游戏操作

### 键盘控制
- **W/A/S/D** 或 **↑/←/↓/→** - 移动角色
- **空格键** - 与地块交互（种植/收获/清理）
- **I键** - 打开/关闭背包
- **H键** - 显示/隐藏帮助信息
- **ESC键** - 返回登录界面（在农场中）或退出游戏（在登录界面）

### 鼠标控制
- 登录界面用鼠标点击选择玩家和农场
- 背包界面可使用鼠标滚轮滚动

## 项目结构

```
farm_game/
├── main.py              # 游戏主程序入口
├── config.py            # 游戏配置文件
├── database.py          # 数据库连接和操作模块
├── player.py            # 玩家角色类
├── login_scene.py       # 登录场景
├── farm_scene.py        # 农场主场景
├── inventory_ui.py      # 背包UI系统
├── requirements.txt     # Python依赖包
└── README.md           # 本文件
```

## 数据库表结构

游戏使用以下主要数据表：
- `game.Player` - 玩家信息（等级、经验、货币等）
- `game.Farm` - 农场信息（名称、土壤质量等）
- `game.Plot` - 地块状态（坐标、作物、生长状态等）
- `game.ItemCatalog` - 物品字典（种子、产物、工具等）
- `game.CropVariety` - 作物品种（生长时间、产量等）
- `game.Inventory` - 库存系统
- `game.ActionLog` - 操作日志

## 游戏截图说明

### 登录界面
- 显示所有可用玩家
- 选择玩家后显示其拥有的农场
- 显示玩家的等级、金币、宝石等信息

### 游戏主界面
- 顶部显示玩家和农场信息
- 中央显示农场地块和角色
- 地块颜色表示状态：
  - 棕色：空地
  - 浅绿色：生长中
  - 金黄色：成熟（可收获）
  - 灰色：枯萎
- 底部显示交互提示

### 背包界面
- 显示所有库存物品
- 物品按类型分类并显示图标
- 显示数量和单价
- 支持滚动查看

## 开发说明

### 扩展功能建议
- [ ] 添加更多作物品种
- [ ] 实现动物饲养系统
- [ ] 添加建筑系统
- [ ] 实现任务系统
- [ ] 添加交易市场
- [ ] 多人联机功能
- [ ] 添加天气系统
- [ ] 实现季节变化

### 已知问题
- 游戏窗口大小固定为1280x720
- 作物生长时间基于真实时间（可能需要很长时间）
- 暂无音效和背景音乐

## 技术栈

- **Python 3.x** - 编程语言
- **Pygame 2.5.2** - 游戏引擎
- **pymssql 2.2.11** - SQL Server数据库连接
- **SQL Server** - 数据存储

## 故障排除

### 1. 无法连接数据库
- 检查SQL Server是否正在运行
- 确认config.py中的数据库配置正确
- 确保数据库FarmGameDB已创建
- 检查防火墙设置

### 2. 导入模块错误
```bash
# 重新安装依赖
pip install -r requirements.txt --force-reinstall
```

### 3. 游戏运行缓慢
- 检查CPU和内存使用情况
- 尝试降低FPS（修改config.py中的FPS值）
- 确保没有其他大型程序占用资源

### 4. 中文显示乱码
- 确保所有.py文件保存为UTF-8编码
- 检查数据库的字符集设置

## 许可证

本项目仅供学习和研究使用。

## 作者

谈烨

## 更新日志

### Version 1.0.0 (2025-11-06)
- ? 初始版本发布
- ? 实现基础登录系统
- ? 实现角色移动和动画
- ? 实现种植和收获系统
- ? 实现背包UI
- ? 连接数据库实现数据持久化

---

**祝游戏愉快！** ??

